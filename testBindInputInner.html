
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="try to bind input">
    <meta name="author" content="BH_Lin">
    <link rel="shortcut icon" href="">

    <title>Try Bind Input</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery-1.11.1.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src='js/bootstrap.min.js'></script>

    <script>

        var REQUEST_AUTOFILL_PASSWORD_VIA_GENERATOR = 11034;
        var SHOW_STRONG_PASSWORD_VIA_GENERATOR= 11035;

        $('document').ready(function() {
            console.log('document is ready');

            generatePassword();

            if(incommingPwd != undefined) {
                $('#newPwd').val(eventData.strongPassword);
            }
        });

        function clickbutton() {
            console.log('click');
            var msgObj = {
                    actionType: REQUEST_AUTOFILL_PASSWORD_VIA_GENERATOR,
                    strongPassword: $('#newPwd').val()
            };
            var strObj = JSON.stringify(msgObj);
            window.parent.postMessage(strObj, "*");
            //window.top.postMessage(strObj, "*");
        }

        function generatePassword() {
            var length = 8,
                charset = "abcdefghijklnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",
                retVal = "";
            for (var i = 0, n = charset.length; i < length; ++i) {
                retVal += charset.charAt(Math.floor(Math.random() * n));
            }
            //return retVal;

            $('#newPwd').val(retVal);
        }


        var incommingPwd ;
        function messageHandler(e) {

            console.log(e.data);

            if((typeof e.data) === "string") {
                    var eventData = JSON.parse(e.data);
                    if(eventData.action === SHOW_STRONG_PASSWORD_VIA_GENERATOR) {
                        console.log("receive aciton: SHOW_STRONG_PASSWORD_VIA_GENERATOR _" + eventData.strongPassword + "_");
                        document.getElementById("newPwd").disabled = true;
                        $("#newPwd").css("background-color", "white");
                        $('#newPwd').val(eventData.strongPassword);
                    } else {
                        return ;
                    }
            } else {
                return;
            }
        }

        if(window.addEventListener) {
            window.addEventListener('message', messageHandler);
        } else {
            window.addEventListener('onmessage', messageHandler);
        }

    </script>

  </head>

  <!--<body style='background-image:url(img/pwdGenerator.png);background-repeat: no-repeat;'>-->
  <body style='padding: 20px;background-color:#eee;'>

    <div class="container">
      <div class="form-group">
        <!--<label for="exampleInputEmail1">Password:</label>-->
        <input type="text" class="form-control" id="newPwd">
        <label for="exampleInputEmail1">DirectPass will automatically remember the strong password shown above</label>
      </div>

      <button id='btnGeneratePwd' onclick='generatePassword()' class='btn btn-danger'>
          <span class="glyphicon glyphicon-repeat"></span>
          Create</button>
      <button onclick='clickbutton()' class='btn btn-primary'>Ok! Use this</button>

    </div> <!-- /container -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  </body>
</html>
